# [227. Basic Calculator II](https://leetcode.com/problems/basic-calculator-ii/)

Medium

Topics: stack, string operations, math

I'm a bit rusty on stack, so this question took me a while.

## Solution: stack, storing operators.

```python
class Solution:
    def calculate(self, s: str) -> int:
        """
        Summary:
            Evaluate the expression.
            Assume the expression is always valid.
            All intermediate results will be in the range of [-2^31, 2^31-1].
        Args:
            (str) s which represents an expression
                s consists of integers and operators
                 ('+', '-', '*', '/') separated by some number of spaces.
        Returns:
            Evaluated value.
        """
        # Stores the closest number encountered. 
        # Therefore, is the right operand.
        num = 0
        # previous operator that we have encountered.
        pre_op = '+'
        # To allow processing the last pre_op in the stack.
        # In fact, any one of +-*/ works.
        s += '+'
        stack = []
        for c in s:
            # Handle multi-digit numbers.
            if c.isdigit():
                num = num * 10 + int(c)
            # Ignore whitespaces.
            elif c == ' ':
                continue
            # c is an operator in +-*/
            else:
                if pre_op == '+':
                    stack.append(num)
                elif pre_op == '-':
                    stack.append(-num)
                # * and / has priority over + and -.
                # So directly calculate their result and add to stack.
                elif pre_op == '*':
                    operand = stack.pop()
                    # Push evaluated value to stack.
                    stack.append(operand * num)
                elif pre_op == '/':
                    operand = stack.pop()
                    # Round division result to integer closest to zero.
                    stack.append(math.trunc(operand / num))
                # reset operand number to 0
                num = 0
                # Update operator that we have encountered that we should work with.
                pre_op = c
        # stack is left with integers to add together.
        return sum(stack)
```



**Intuition:** 

Calculator problems and bracket problems are almost always using stack for solution.

We don't have brackets, so directly evaluate * and / on the go and push it back to the stack. In order to evaluate, we need to have both left operand and right operand. 

For the left operand, it should be on the top of the stack (last index of the list) already, and the right operand should be the current number (`num`) that we are processing.

For + and - operations, we can directly push them onto the stack and treat `-` as negation, such that in the return statement we can just do `sum(stack)`. And it preserves the priority that + and - should be processed after * and /.

Note that we only know how to evaluate when we reach the right operand of the operator, so we need to save the operator that we encountered in a variable (`pre_op`). We know that we can evaluate the previous expression when we are no longer on a digit, aka we are on a  new operator. Therefore, to accomodate for evaluating the last expression, we add an operator at the end of the string.

:sweat: sweaty problem 